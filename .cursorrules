# Cursor 项目全局规则 (Claude 4.6 Sonnet 极致精简版)

## 1. 角色定义
你是一位资深全栈工程师，追求代码的极致简洁与可读性。

## 2. 编码原则 (节省额度与提升清晰度)
- **拒绝注释**：除非我明确要求（例如：针对极其复杂的算法逻辑），否则**禁止**在代码中添加任何注释。代码应当通过命名规范实现自解释。
- **精准修改**：除非我要求重构，否则只修改受影响的代码块。禁止为了改一个小功能而重写整个文件。
- **DRY 原则**：不要重复造轮子。优先使用项目中已有的工具类和 Hooks。
- **模块化**：保持函数短小精悍。逻辑复杂的代码需添加简明扼要的注释。
- **Typescript 优先**：如果是 JS/TS 项目，禁止使用 `any`，必须定义接口或类型。

## 3. 回答风格偏好
- **拒绝废话**：不需要回答“好的”、“没问题”等客套话。直接输出代码和必要的逻辑说明。
- **对比展示**：如果修改点较多，请使用 `// ...` 略过未改动部分，只展示核心变化。
- **错误预防**：在给出方案前，先检查是否会导致潜在的内存泄漏或性能瓶颈。

## 4. 自动任务 (Agent 模式专属)
- 当我使用 Composer (Cmd+I) 时，如果涉及安装新包，请先询问我。
- 修复 Bug 前，请先尝试在终端运行相关的测试命令（如 `npm test` 或 `pytest`）。
- 每次修改完代码后，请自动检查是否有 Lint 错误。

## 5. 项目要求（后端）
我需要写一个 Python 程序（本地的 Python 命令是 python3，不要直接使用 python），抓取特定美股标的的历史（最长 3 个月）到现在分时数据
- 数据源是 yfinance，控制访问频率 <= 5 每分钟。注意分时（1min）数据可能有获取时间范围，需要额外的分段
- 这个程序可以指定标的，如果不指定默认是 SNDK / QQQ / NVDA 
- 这个程序拉到的分时数据（分钟级）持久化到"./data/标的.records"文件下，每一行是 日期: 分时数据（json) 格式
- 这个程序如果指定初始化模式，则删除已有数据，拉取历史数据并持久化数据。如果不指定，则默认先读区文件，拉取从文件中最后一个交易日到最近一个交易日的数据，并 append 到文件末尾
- 拉取分时数据后，同时计算（考虑合并历史数据）RSI(14)、EMA(10/20)、VWAP 并一起持久化

## 6. 项目要求（前端）
我需要写一个 React 程序，展示数据，并提供一个简单的 UI 界面，支持以下功能：
- 选择标的
- 选择时间范围
- 根据 data 下的数据展示分时数据、RSI(14)、EMA(10/20)、VWAP 指标
- 新增接口可以触发增量更新

## 7. 项目要求（数据分析-交易评分）
我需要根据 data 中的数据标的交易数据进行数据分析(新的Python脚本)。
数据说明
- 数据有两类，1 是标的的分时数据，由 Python 抓取而来，每个文件名是“标的.records"；2 是交易记录，是最近的交易记录，文件名是 transaction.csv
- 交易记录有些标的的历史记录尚没有抓取（文件不存在），可以忽略这些交易记录

这个数据分析的主要目的是 **日内超短交易质量评分系统**，目标：判断这笔交易 值不值得做
- 系统核心理念：复盘的本质不是看盈亏，而是看 —— 这笔交易在“当时”是否具有正期望结构？（结构正确性，入场质量， 出场质量，风控纪律，情绪痕迹）
- 为了方便你后续进行程序化（Python/量化平台），我们需要将感性的复盘转化为**确定性的逻辑开关**。

以下是将超短复盘模型拆解为**量化规则**的框架
## 核心算法逻辑：正期望结构判定

### 一、 结构正确性 (Structure Alignment) - 30分

*判定目标：你在这一分钟买入时，市场是否处于“多头共振”状态？*

| 维度 | 量化规则 (多头示例，空头反向) | 判定逻辑 (程序化条件) | 分值 |
| --- | --- | --- | --- |
| **S1: 趋势共振** | 价格与均线位置 |  且  (均线扣称向上) | 10 |
| **S2: 相对强度** | 个股 vs 指数 |  (进场前30分钟超额收益) | 10 |
| **S3: 波动收敛** | 突破前的震荡幅度 |  (代表处于爆发前夜而非乱战) | 10 |

---

### 二、 入场质量 (Entry Efficiency) - 25分

*判定目标：你买在了“起爆点”还是“鱼尾巴”？*

| 维度 | 量化规则 | 判定逻辑 (程序化条件) | 分值 |
| --- | --- | --- | --- |
| **E1: 量能触发** | 相对倍量 () |  | 10 |
| **E2: 价格偏离** | 追高系数 |  < 0.7 | 10 |
| **E3: 静态位置** | 乖离率 (Bias) |  (防止买在短线力竭点) | 5 |

---

### 三、 出场质量 (Exit Efficiency) - 20分

*判定目标：你是“恐慌下车”还是“利润最大化”？*

| 维度 | 量化规则 | 判定逻辑 (程序化条件) | 分值 |
| --- | --- | --- | --- |
| **X1: 利润留存比** |  转化率 |  | 10 |
| **X2: 反转卖出** | 趋势破位卖出 | 价格跌破  或  分钟低点后 2 根 K 线内成交 | 10 |
| **X3: 盲目持有** | 时间成本 | 买入后  分钟内价格未脱离成本区 (横盘) 是否果断离场 | 5 |

---

### 四、 风控纪律 (Risk Control) - 15分

*判定目标：执行是否违背了“生存法则”？*

| 维度 | 量化规则 | 判定逻辑 (程序化条件) | 分值 |
| --- | --- | --- | --- |
| **R1: 硬止损执行** | 最大回撤控制 | 实际亏损  预设止损位 (如 -3%) | 10 |
| **R2: 仓位一致性** | 风险敞口 | 实际买入金额与账户总额比例是否符合模型预设 | 5 |

---

### 五、 情绪痕迹 (Sentiment Trace) - 10分

*判定目标：量化分时图上的“急躁”与“贪婪”。*

| 维度 | 量化规则 | 判定逻辑 (程序化条件) | 分值 |
| --- | --- | --- | --- |
| **T1: 抢跑/滞后** | 信号一致性 |  (时间差 > 3分钟扣分) | 5 |
| **T2: 报复性交易** | 交易频率限制 | 该笔交易与上一笔亏损交易的时间间隔是否 < 15 分钟 | 5 |

---

## 复盘输出结果 (Markdown 格式示例)

程序运行后，每笔交易应生成如下摘要：

### **复盘报告：[代码.SH/SZ] - 2026-XX-XX**

> **综合评分：82/100 (等级：优秀执行)**

* **[结构] 30/30:** 完美共振。个股强于大盘 2%，VWAP 趋势向上。
* **[入场] 15/25:** 扣分项。买入时已偏离均线 3.2%，存在追高嫌疑，RV 倍量不明显。
* **[出场] 18/20:** 优。在高位放量滞涨后的第二分钟离场，抓住了 85% 的波动。
* **[风控] 15/15:** 止损位设置合理且未触碰。
* **[情绪] 4/10:** 扣分项。买入信号触发后延迟了 5 分钟才下单，存在心理犹豫。


## 8. 项目要求（数据分析-交易总结）
我需要根据 data 中的数据标的交易数据进行数据分析(新的Python脚本)。
数据说明
- 数据有两类，1 是标的的分时数据，由 Python 抓取而来，每个文件名是“标的.records"；2 是交易记录，是最近的交易记录，文件名是 transaction.csv
- 交易记录有些标的的历史记录尚没有抓取（文件不存在），可以忽略这些交易记录

这个数据分析的主要目的是 **分析交易特性**，目标：通过将**分时数据（行情）与交易记录（动作）**对齐，我们可以从心理、技术和执行三个维度还原你的交易逻辑。
下是一个量化分析模型的逻辑框架，分为四个核心模块：

1. 基础画像模块 (Basic Statistics)
首先通过静态数据，定义你的交易“底色”。

胜率与盈亏比： 计算总期望值，判断你是靠“高准确率”生存还是靠“捕捉大行情”生存。

持仓周期分布： 统计从买入到卖出的平均时长，识别你是日内超短、波段还是长线。

周内/日内活跃度： 分析你在交易日哪个时段（如开盘半小时、尾盘）交易最频繁，以及胜率最高。

2. 择时质量分析 (Timing & Entry/Exit)
这是最核心的部分，需要将交易点位映射到分时图（Min-level）上。

入场位置评价： * 左侧 vs 右侧： 观察买入点是在价格下跌企稳前（抄底）还是放量突破后（追高）。

相对位置： 买入点处于当日振幅的百分比位置。

出场效率 (Excursion Analysis)：

MFE (最大潜在利润)： 卖出后，价格是否继续大幅上涨？（是否存在恐慌性早卖）

MAE (最大回撤)： 买入后，价格反向运行了多少才企稳？（入场点是否过于急躁）

反向指标检验： 统计“卖出即起飞”或“买入即巅峰”的频率。

3. 价格行为一致性 (Price Action Consistency)
分析你下单时的市场环境（Context）。

趋势跟随度： 下单时，价格是处于均线（如 VWAP 或 20线）上方还是下方？你是在顺势而为还是执着于逆势。

波动率偏好： 你倾向于在缩量盘整时潜伏，还是在放量剧烈波动时入场？

成交量分布： 你的买入是否伴随成交量异常放大（确认信号）。

4. 风险控制与心态画像 (Risk & Psychology)
通过数据捕捉潜意识里的交易缺陷。

止损果断性： 亏损单的持仓时长是否显著长于盈利单？（是否存在“扛单”行为）

加仓逻辑： 盈利加仓（锦上添花）还是亏损加仓（摊平摊死）。

复利与情绪性交易： 在一笔大亏后，下一笔交易的间隔时间和仓位变化情况（是否存在报复性交易）。

5. 可考虑建议（非强制）： 为分时表增加计算列，如 VWAP（成交量加权平均价）、Relative_Volume（相对成交量）、Volatility（波动率）。